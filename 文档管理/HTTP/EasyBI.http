POST http://localhost:8082/api/query/executeSql?userId=111 HTTP/1.1
Content-Type: application/json
cookie: Hm_lvt_e28dada1b683a2145254643cfcba355d=1680148168; __bid_n=18730a27f968592a307dc8; pcl_sid_cross=748B328F70154BEC9AAF74DA752EADBC; pcl_brandid=429; sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%2221038920%22%2C%22%24device_id%22%3A%221849d0024bb1401-060d0ec3e66ad2-7d5d5475-2073600-1849d0024bc13a9%22%2C%22props%22%3A%7B%22%24latest_referrer%22%3A%22%E5%8F%96%E5%80%BC%E5%BC%82%E5%B8%B8%22%2C%22%24latest_traffic_source_type%22%3A%22%E8%87%AA%E7%84%B6%E6%90%9C%E7%B4%A2%E6%B5%81%E9%87%8F%22%2C%22%24latest_search_keyword%22%3A%22%E6%9C%AA%E5%8F%96%E5%88%B0%E5%80%BC%22%2C%22%24latest_referrer_host%22%3A%22%E5%8F%96%E5%80%BC%E5%BC%82%E5%B8%B8%22%7D%2C%22first_id%22%3A%221849d0024bb1401-060d0ec3e66ad2-7d5d5475-2073600-1849d0024bc13a9%22%7D
platform: EASYBI
token: opt.authorize=a2eb4fecbcbf4d50b99b92ba4f48507b

{"sourceId":27,"sql":"select \nt1.Id,\nt2.Code as \\\"订单编号\\\",\n(case \n    when t2.OrderStatus= 0  then '已取消' \n    when t2.OrderStatus= 1  then '待付款'\n    when t2.OrderStatus= 2  then '待发货'\n    when t2.OrderStatus= 4  then '已发货'\n    when t2.OrderStatus= 8  then '交易成功'\n    when t2.OrderStatus= 16  then '交易完成'\n    when t2.OrderStatus= 1100  then '待成团'\n    when t2.OrderStatus= 20  then '订单关闭'\n    when t2.OrderStatus= 1200  then '定金支付成功'\n    end) as \\\"订单状态\\\",\n(case \n    when t3.LedgerStatus= 0  then '已取消' \n    when t3.LedgerStatus= 1  then '待分账'\n    when t3.LedgerStatus= 5  then '手工暂停'\n    when t3.LedgerStatus= 10  then '已分账'\n    when t3.LedgerStatus= 20  then '异常单'\n    end) as \\\"分帐状态\\\",\nt3.SupplierName as \\\"工厂\\\",\nt2.Name as \\\"门店\\\",\nt4.Code as \\\"分销员工号\\\",\nt4.MobileNo as \\\"分销员手机号\\\",\nt4.Name as \\\"分销员姓名\\\",\nt2.OrderTime as \\\"下单日期\\\",\nt2.PayTime as \\\"付款日期\\\",\nt1.ExpressCode as \\\"快递单号\\\",\nt1.CreateDate as \\\"发货日期\\\",\nt5.ReceivingTime as \\\"确认收货日期\\\",\nt3.LastModifiedDate as \\\"分账日期\\\",\nt1.BarCode as \\\"SKU条码\\\",\nt1.RetailPrice as \\\"吊牌价\\\",\nround(t1.AvgAmount / t1.Quantity,2)  as \\\"成交价\\\",\nround(t1.RetailPrice * t1.Quantity,2) as \\\"标准金额\\\",\nt1.AvgAmount as \\\"实付金额\\\",\nround(t1.AvgAmount / (t1.RetailPrice * t1.Quantity),2) as \\\"折扣率\\\",\nt1.Amount - t1.AvgAmount as \\\"店铺活动优惠金额\\\",\nt1.OrderCouponAmount + t1.ProCouponAmount as \\\"优惠券优惠金额\\\",\nt4.Commission as \\\"分销佣金\\\",\nround(t1.AvgAmount - t3.FXMoney - t3.SupplierMoney - (t3.BrandMoney * (t1.AvgAmount / t2.RealPayAmount)),2) as \\\"店铺结算金额\\\",\nround((t3.BrandMoney * (t1.AvgAmount / t2.RealPayAmount)),2) as \\\"南极结算金额\\\",\nt3.SupplierMoney as \\\"工厂结算金额\\\",\nconvert(ifnull(t4.Commission,0), decimal(12,2)) + (round(t1.AvgAmount - t3.FXMoney - t3.SupplierMoney - (t3.BrandMoney * (t1.AvgAmount / t2.RealPayAmount)),2)) + SupplierMoney + round((t3.BrandMoney * (t1.AvgAmount / t2.RealPayAmount)),2) as \\\"已结算金额\\\"\nfrom\n(\n-- 查询已经发货的订单明细\n    select \n    t1.Id as Id,\n    t1.OrderId,\n    t1.BarCode as BarCode,\n    t1.PriceOriginal as PriceOriginal,\n    t1.RetailPrice as RetailPrice,\n    t1.AvgAmount as AvgAmount,\n    t1.Quantity as Quantity,\n    t1.Amount as Amount,\n    t2.ExpressCode as ExpressCode,\n    t2.CreateDate as CreateDate,\n    convert(t1.OrderCouponAmount, decimal(12,2)) as OrderCouponAmount,\n    convert(t1.ProCouponAmount, decimal(12,2)) as ProCouponAmount\n    from\n    (\n        select \n        Id,\n        OrderId,\n        BarCode,\n        PriceOriginal,\n        RetailPrice,\n        AvgAmount,\n        Quantity,\n        Amount,\n        OrderCouponAmount,\n        ProCouponAmount\n        from `ezp-mall`.`mall_sales_order_dtl`\n        where 1=1\n        $if(BrandId)$\n        and BrandId = $(BrandId)$\n        $endif$\n        $if(BarCode)$\n        and BarCode = $(BarCode)$\n        $endif$\n    ) as t1 inner join\n    (\n        select \n        OrderDtlId,\n        ExpressCode,\n        CreateDate\n        from `ezp-mall`.`mall_sales_order_express_dtl`\n        where 1=1\n        $if(BrandId)$\n        and BrandId = $(BrandId)$\n        $endif$\n    ) as t2 on t1.Id = t2.OrderDtlId\n    \n    union all\n--查询未发货的订单明细\n    select \n    Id as Id,\n    OrderId as OrderId,\n    BarCode as BarCode,\n    PriceOriginal as PriceOriginal,\n    RetailPrice as RetailPrice,\n    AvgAmount as AvgAmount,\n    Quantity as Quantity,\n    Amount as Amount,\n    null as ExpressCode,\n    null as CreateDate,\n    convert(OrderCouponAmount, decimal(12,2)) as OrderCouponAmount,\n    convert(ProCouponAmount, decimal(12,2)) as ProCouponAmount\n    from\n    `ezp-mall`.`mall_sales_order_dtl` \n    where 1=1\n    $if(BrandId)$\n    and BrandId = $(BrandId)$\n    $endif$\n    and Id not in \n    (\n        select \n        t1.Id\n        from\n        (\n            select Id from `ezp-mall`.`mall_sales_order_dtl` where 1=1\n            $if(BrandId)$\n            and BrandId = $(BrandId)$\n            $endif$\n        ) as t1 inner join\n        (\n            select OrderDtlId from `ezp-mall`.`mall_sales_order_express_dtl` where 1=1\n            $if(BrandId)$\n            and BrandId = $(BrandId)$\n            $endif$\n        ) as t2 on t1.Id = t2.OrderDtlId\n    )\n) as t1\ninner join\n--查询订单主表\n(\n    select\n    o.Id as Id,\n    o.Code as Code,\n    o.EShopId as EShopId,\n    o.OrderTime as OrderTime,\n    o.PayTime as PayTime,\n    o.CouponUseAmount as CouponUseAmount,\n    o.OrderStatus as OrderStatus,\n    o.RealPayAmount,\n    s.Name as Name\n    from\n    (\n        select \n        Id as Id,\n        Code as Code,\n        EShopId as EShopId,\n        OrderTime as OrderTime,\n        PayTime as PayTime,\n        CouponUseAmount as CouponUseAmount,\n        OrderStatus as OrderStatus,\n        PayAmount - ExpressCost as RealPayAmount\n        from `ezp-mall`.`mall_sales_order`\n        where 1 = 1\n        $if(BrandId)$\n        and BrandId = $(BrandId)$\n        $endif$\n        $if(StartPayTime)$\n        and DATE_FORMAT(PayTime, '%Y-%m-%d') >= $(StartPayTime)$\n        $endif$\n        $if(EndPayTime)$\n        and DATE_FORMAT(PayTime, '%Y-%m-%d') <= $(EndPayTime)$\n        $endif$\n        $if(StartOrderTime)$\n        and DATE_FORMAT(OrderTime, '%Y-%m-%d') >= $(StartOrderTime)$\n        $endif$\n        $if(EndOrderTime)$\n        and DATE_FORMAT(OrderTime, '%Y-%m-%d') <= $(EndOrderTime)$\n        $endif$\n    ) as o\n    inner join\n    (\n        select \n        Id,\n        Name as Name\n        from `ezp-bd`.`ed_base_shop`\n        where 1=1\n        $if(BrandId)$\n        and BrandId = $(BrandId)$\n        $endif$\n        -- 组织选择器代码\n        @{Id},{SH:$(SH)$},{PQ:$(PQ)$},{GP:$(GP)$}@\n    ) as s on o.EShopId = s.Id\n) as t2 on t1.OrderId = t2.Id\ninner join\n--查询分帐表\n(\n    select \n    d.OrderDtlId as OrderDtlId,\n    l.LedgerStatus as LedgerStatus,\n    s.SupplierName as SupplierName,\n    l.LastModifiedDate as LastModifiedDate,\n    l.BrandEstimateMoney as BrandEstimateMoney,\n    convert(l.ShopMoney, decimal(12,2)) as ShopMoney,\n    convert(l.BrandMoney, decimal(12,2)) as BrandMoney,\n    convert(d.SupplierMoney, decimal(12,2)) as SupplierMoney,\n    d.FXMoney as FXMoney,\n    d.SupplierMoneySum as SupplierMoneySum\n    from\n    (\n        select \n        d.OrderDtlId as OrderDtlId,\n        d.SupplierMoney as SupplierMoney,\n        d.LedgerId as LedgerId,\n        d.ItemSupplierId,\n        d.FXMoney,\n        dd.SupplierMoneySum\n        from\n        (\n            select \n            OrderDtlId as OrderDtlId,\n            SupplierMoney as SupplierMoney,\n            LedgerId as LedgerId,\n            ItemSupplierId,\n            FXMoney,\n            OrderId\n            from `ezp-mall`.`mall_supplier_ledger_dtl`\n            where 1=1\n            $if(BrandId)$\n            and BrandId = $(BrandId)$\n            $endif$\n  @{ItemSupplierId},{SU:$(SU)$}@      ) as d\n        left join\n        (\n            select \n            sum(SupplierMoney) as SupplierMoneySum,\n            OrderId\n            from `ezp-mall`.`mall_supplier_ledger_dtl`\n            where 1=1\n            $if(BrandId)$\n            and BrandId = $(BrandId)$\n            $endif$\n            group by OrderId\n        ) as dd on d.OrderId = dd.OrderId\n    ) as d\n    inner join \n    (\n        select \n        Id,\n        LedgerStatus as LedgerStatus,\n        LastModifiedDate as LastModifiedDate,\n        ShopMoney as ShopMoney,\n        BrandMoney as BrandMoney,\n        BrandEstimateMoney as BrandEstimateMoney\n        from `ezp-mall`.`mall_supplier_ledger`\n        where 1=1\n        $if(BrandId)$\n        and BrandId = $(BrandId)$\n        $endif$\n        $if(StartLedgeTime)$\n        and DATE_FORMAT(LastModifiedDate, '%Y-%m-%d') >= $(StartLedgeTime)$\n        $endif$\n        $if(EndLedgeTime)$\n        and DATE_FORMAT(LastModifiedDate, '%Y-%m-%d') <= $(EndLedgeTime)$\n        $endif$\n    ) as l on l.Id = d.LedgerId\n    inner join \n    (\n        select \n        Id,\n        SupplierName as SupplierName\n        from `ezp-bd`.`bd_sys_supplier`\n        where 1=1\n        $if(BrandId)$\n        and BrandId = $(BrandId)$\n        $endif$\n    ) as s on d.ItemSupplierId = s.Id\n) as t3 on t3.OrderDtlId = t1.Id\nleft join\n--分销单表(一个订单明细对应多个分销单)\n(\n    select \n    u.Code as Code,\n    u.MobileNo as MobileNo,\n    u.Name as Name,\n    convert(ifnull(d.Commission,0), decimal(12,2)) as Commission,\n    d.OrderDtlId as OrderDtlId\n    from\n    (\n        select \n        sum(Commission) as Commission,\n        PopulationId,\n        OrderDtlId\n        from `ezp-mall`.`mall_fx_order_commssion_dtl1`\n        where 1=1\n        $if(BrandId)$\n        and BrandId = $(BrandId)$\n        $endif$\n        group by OrderDtlId,PopulationId\n    ) as d \n    inner join \n    (\n        select \n        Id,\n        SgId\n        from `ezp-mall`.`mall_fx_person`\n        where 1=1\n        $if(BrandId)$\n        and BrandId = $(BrandId)$\n        $endif$\n    ) as p on d.PopulationId = p.Id\n    inner join \n    (\n        select \n        Code as Code,\n        MobileNo as MobileNo,\n        Name as Name,\n        Id\n        from `ezp-bd`.`ed_base_sys_user`\n        where 1=1\n        $if(BrandId)$\n        and BrandId = $(BrandId)$\n        $endif$\n        $if(SelectUser)$\n        and\n        (Name like concat('%',$SelectUser$,'%') \n        or\n        MobileNo like concat('%',$SelectUser$,'%')\n        or\n        Code like concat('%',$SelectUser$,'%')\n        )\n        $endif$\n    ) as u on p.SgId = u.Id \n) as t4 on t1.Id = t4.OrderDtlId\ninner join\n--收货表\n(\n    select \n    Id,\n    ReceivingTime \n    from `ezp-mall`.`mall_sales_order_extend` where 1=1\n    $if(BrandId)$\n    and BrandId = $(BrandId)$\n    $endif$\n) as t5 on t1.OrderId = t5.Id\n\nwhere 1=1\n$if(SelectUser)$\nand\n(t4.Name like concat('%',$SelectUser$,'%') \nor\nt4.MobileNo like concat('%',$SelectUser$,'%')\nor\nt4.Code like concat('%',$SelectUser$,'%')\n)\n$endif$\norder by t2.OrderTime desc\n\n\n\n","limit":500,"variables":[{"name":"BarCode","type":"query","valueType":"string","udf":false,"defaultValues":[]},{"name":"SelectUser","type":"query","valueType":"string","udf":false,"defaultValues":[]},{"name":"StartOrderTime","type":"query","valueType":"string","udf":false,"defaultValues":[]},{"name":"StartPayTime","type":"query","valueType":"string","udf":false,"defaultValues":[]},{"name":"StartLedgeTime","type":"query","valueType":"string","udf":false,"defaultValues":[]},{"name":"BrandId","type":"query","valueType":"number","udf":false,"defaultValues":[739]},{"name":"PQ","type":"query","valueType":"string","udf":false,"defaultValues":[]},{"name":"GP","type":"query","valueType":"string","udf":false,"defaultValues":[]},{"name":"SH","type":"query","valueType":"string","udf":false,"defaultValues":[]},{"name":"Id","type":"org","valueType":"string"},{"name":"ItemSupplierId","type":"su","valueType":"string"},{"name":"EndOrderTime","type":"query","valueType":"string","udf":false,"defaultValues":[]},{"name":"EndPayTime","type":"query","valueType":"string","udf":false,"defaultValues":[]},{"name":"EndLedgeTime","type":"query","valueType":"string","udf":false,"defaultValues":[]}]}

### 
POST http://localhost:8082/api/share/supplier/data/distinctvalue?userId=111 HTTP/1.1
Content-Type: application/json
platform: EASYBI
token: pt.authorize=91b10bfeee124fc88ac9888276e3f829

{
  "columns": [
    "供应商"
  ],
  "pageNo": 1,
  "pageSize": 100000,
  "filterName": "go"
}